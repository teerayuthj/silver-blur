!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SilverBlur=e():t.SilverBlur=e()}(this,()=>(()=>{class SilverPriceBlur{constructor(t={}){this.isInitialized=!1,this.blurCheckInterval=null,this.currentBlurState=!1,this.holidayData=null,this.config={holidayJsonUrl:t.holidayJsonUrl||"./config/holidays.json",cdnBaseUrl:t.cdnBaseUrl||null,...t},this.priceElements=["slvUsdBid","slvUsdOffer","slvKgBid","slvKgOffer","slvKgVat","slvUsdChg","slvKgChg"],this.vatLabelElements=[".sv-vat-label"],this.timerContainers=[".sv-event-timer"],console.log("Silver Blur System: Initialized")}getBangkokTime(){const t=new Date;return new Date(t.toLocaleString("en-US",{timeZone:"Asia/Bangkok"}))}async loadHolidayData(){const t=this.config.cdnBaseUrl?`${this.config.cdnBaseUrl}/config/holidays.json`:this.config.holidayJsonUrl;try{console.log(`Silver Blur: Loading holidays from ${t}`);const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return this.holidayData=await e.json(),console.log("Silver Blur: Holiday data loaded successfully"),!0}catch(t){return console.warn("Silver Blur: Failed to load holiday data:",t.message),console.warn("Silver Blur: Continuing with weekend-only blur"),this.holidayData={holidays:{}},!1}}isHoliday(t=null){if(!this.holidayData||!this.holidayData.holidays)return!1;const e=t||this.getBangkokTime(),l=e.getFullYear().toString(),i=`${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;return this.holidayData.holidays[l]&&this.holidayData.holidays[l][i]}getHolidayInfo(t=null){if(!this.holidayData||!this.holidayData.holidays)return null;const e=t||this.getBangkokTime(),l=e.getFullYear().toString(),i=`${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;return this.holidayData.holidays[l]&&this.holidayData.holidays[l][i]?this.holidayData.holidays[l][i]:null}isMarketOpen(){const t=this.getBangkokTime(),e=t.getDay();if(0===e||6===e)return console.log(`Silver Blur: Weekend detected (${0===e?"Sunday":"Saturday"}), price not available`),!1;const l=this.getHolidayInfo(t);return l?(console.log(`Silver Blur: Holiday detected (${l.name}), price not available`),!1):(console.log(`Silver Blur: Bangkok time ${t.toLocaleTimeString("th-TH")}, Price AVAILABLE (weekday, not holiday)`),!0)}applyBlur(){this.currentBlurState||(console.log("Silver Blur: Price not available - applying blur effect"),this.priceElements.forEach(t=>{const e=document.getElementById(t);e&&e.classList.add("sv-blur-price","sv-price-blurred")}),this.vatLabelElements.forEach(t=>{document.querySelectorAll(t).forEach(t=>{t.classList.add("sv-blur-price","sv-price-blurred")})}),this.timerContainers.forEach(t=>{document.querySelectorAll(t).forEach(t=>{t.classList.add("sv-blur-overlay","sv-market-closed")})}),this.currentBlurState=!0)}removeBlur(){this.currentBlurState&&(console.log("Silver Blur: Price available - removing blur effect"),this.priceElements.forEach(t=>{const e=document.getElementById(t);e&&e.classList.remove("sv-blur-price","sv-price-blurred")}),this.vatLabelElements.forEach(t=>{document.querySelectorAll(t).forEach(t=>{t.classList.remove("sv-blur-price","sv-price-blurred")})}),this.timerContainers.forEach(t=>{document.querySelectorAll(t).forEach(t=>{t.classList.remove("sv-blur-overlay","sv-market-closed")})}),this.currentBlurState=!1)}updateBlurStatus(){const t=this.isMarketOpen();t&&this.currentBlurState?this.removeBlur():t||this.currentBlurState||this.applyBlur()}async init(){this.isInitialized?console.log("Silver Blur: Already initialized"):(console.log("Silver Blur: Starting initialization..."),await this.loadHolidayData(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.startBlurSystem()):this.startBlurSystem())}startBlurSystem(){this.updateBlurStatus(),this.blurCheckInterval=setInterval(()=>{this.updateBlurStatus()},3e4),this.isInitialized=!0,console.log("Silver Blur: System started, checking every 30 seconds")}stop(){this.blurCheckInterval&&(clearInterval(this.blurCheckInterval),this.blurCheckInterval=null),this.removeBlur(),this.isInitialized=!1,console.log("Silver Blur: System stopped")}addHoliday(t,e,l,i,a="",o="custom"){if(!this.holidayData||!this.holidayData.holidays)return console.error("Silver Blur: Holiday data not loaded"),!1;const r=t.toString(),s=`${String(e).padStart(2,"0")}-${String(l).padStart(2,"0")}`;return this.holidayData.holidays[r]||(this.holidayData.holidays[r]={}),this.holidayData.holidays[r][s]={name:i,name_en:a||i,type:o},console.log(`Silver Blur: Added holiday - ${i} (${t}-${String(e).padStart(2,"0")}-${String(l).padStart(2,"0")})`),!0}removeHoliday(t,e,l){if(!this.holidayData||!this.holidayData.holidays)return console.error("Silver Blur: Holiday data not loaded"),!1;const i=t.toString(),a=`${String(e).padStart(2,"0")}-${String(l).padStart(2,"0")}`;if(this.holidayData.holidays[i]&&this.holidayData.holidays[i][a]){const o=this.holidayData.holidays[i][a].name;return delete this.holidayData.holidays[i][a],console.log(`Silver Blur: Removed holiday - ${o} (${t}-${String(e).padStart(2,"0")}-${String(l).padStart(2,"0")})`),!0}return console.warn(`Silver Blur: Holiday not found (${t}-${String(e).padStart(2,"0")}-${String(l).padStart(2,"0")})`),!1}listHolidays(t){if(!this.holidayData||!this.holidayData.holidays)return console.error("Silver Blur: Holiday data not loaded"),[];const e=t.toString(),l=this.holidayData.holidays[e]||{};return console.log(`=== Holidays for ${t} ===`),Object.keys(l).sort().forEach(e=>{const i=l[e];console.log(`${t}-${e}: ${i.name} (${i.type})`)}),console.log("=== End List ==="),l}testTimeRange(){const t=this.getBangkokTime(),e=this.getHolidayInfo(t);console.log("=== Silver Blur Time Test ==="),console.log("Current Bangkok Time:",t.toLocaleString("th-TH",{timeZone:"Asia/Bangkok"})),console.log("Day of Week:",["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()]),console.log("Is Holiday:",e?`Yes - ${e.name}`:"No"),console.log("Blur Logic: Weekends + Holidays only"),console.log("Market Status:",this.isMarketOpen()?"OPEN":"CLOSED"),console.log("Current Blur State:",this.currentBlurState?"BLURRED":"VISIBLE"),console.log("=== End Test ===")}}return window.silverBlur=window.silverBlur||new SilverPriceBlur,window.initSilverBlurCDN=t=>(window.silverBlur=new SilverPriceBlur({cdnBaseUrl:t}),window.silverBlur.init()),document.addEventListener("DOMContentLoaded",async()=>{setTimeout(async()=>{await window.silverBlur.init()},1e3)}),window.testSilverBlur=()=>{window.silverBlur.testTimeRange()},window.addHoliday=(t,e,l,i,a="",o="custom")=>window.silverBlur.addHoliday(t,e,l,i,a,o),window.removeHoliday=(t,e,l)=>window.silverBlur.removeHoliday(t,e,l),window.listHolidays=t=>window.silverBlur.listHolidays(t),{}})());
//# sourceMappingURL=silver-blur.min.js.map